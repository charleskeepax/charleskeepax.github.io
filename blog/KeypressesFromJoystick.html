<!DOCTYPE html> <html> <head> <meta http-equiv="content-type" content="text/html; charset=utf-8"/> <meta http-equiv="content-language" content="en-gb"/> <meta name="language" content="english"/> <meta name="author" content="charles keepax"/> <meta name="robots" content="index, follow"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <link rel="sitemap" href="/sitemap.xml" type="application/xml" title="Sitemap"/> <link rel="shortcut icon" href="/favicon.ico" type="image/vnd.microsoft.icon"/> <link rel="stylesheet" href="/styles/layout.css" type="text/css" media="screen and (min-width: 750px)"/> <link rel="stylesheet" href="/styles/m_layout.css" type="text/css" media="screen and (max-width:750px)"/> <link rel="stylesheet" href="/styles/webblog.css" type="text/css" media="screen and (min-width: 750px)"/> <link rel="stylesheet" href="/styles/m_webblog.css" type="text/css" media="screen and (max-width: 750px)"/> <meta name="description" content="Overview of a simple program that generates keypresses from joystick events."/> <meta name="keywords" content="charles keepax, charles, keepax, development,gaming"/> <title>Keypresses From Joystick - Charles Keepax</title> </head> <body> <div> <div id="title_container"> <h1>Charles Keepax's Blog</h1> <a id="feedlink" href="/atom.xml"><img src="/image/rss.svg" height="24" width="24" alt="Atom Feed"/></a> </div> <div id="sidebar_background"></div> <div id="column_container"> <div id="sidebar_container"> <img id="sidebar_icon" src="/image/menu.svg" alt="Toggle Navigation Menu" height="24" width="24"/> <ul class="nav_list"> <li class="nav_item"><div><a href="/blog/blog.html"><img class="spicon" src="/image/calendar.svg" height="12" width="12"/>Blog</a></div></li> <li><ol id="blogposts_sidebar" class="nav_list"> <li class="nav_item"><div> <a href="/blog/WebsiteIcons.html">Website Icons</a> </div></li> <li class="nav_item"><div> <a href="/blog/KeypressesFromJoystick.html">Keypresses From Joystick</a> </div></li> <li class="nav_item"><div> <a href="/blog/IntelHEXChecksumsInVim.html">Intel HEX Checksums in Vim</a> </div></li> <li class="nav_item"><div> <a href="/blog/HTCHeroDisassembly.html">HTC Hero Disassembly</a> </div></li> <li class="nav_item"><div> <a href="/blog/CPPForEmbedded.html">C++ for Embedded?</a> </div></li> <li class="nav_item"><div><a href="/blog/archive.html">Blog Archive</a></div></li> <li class="nav_item"><div><a href="/blog/tags.html">Blog Tags</a></div></li> </ol></li> <li class="nav_item"><div><a href="/cv.html"><img class="spicon" src="/image/doc.svg" height="12" width="12"/>Curriculum Vitae</a></div></li> <li><ol class="nav_list"> <li class="nav_item"><div><a href="/cv.html#cv_profile">Profile</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_employmenthistory">Employment History</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_education">Education</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_publications">Publications</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_references">References</a></div></li> </ol></li> <li class="nav_item"><div><a href="/links.html"><img class="spicon" src="/image/link.svg" height="12" width="12"/>Links</a></div></li> <li><ol class="nav_list"> <li class="nav_item"><div><a href="https://bitbucket.org/charleskeepax">Bitbucket</a></div></li> <li class="nav_item"><div><a href="http://github.com/charleskeepax">Github</a></div></li> <li class="nav_item"><div><a href="http://uk.linkedin.com/pub/charles-keepax/24/b79/59a">LinkedIn</a></div></li> <li class="nav_item"><div><a href="http://stackoverflow.com/users/735744/charles-keepax">Stackoverflow</a></div></li> </ol></li> <li class="nav_item"><div> <a href="mailto:&#99;&#107;&#101;&#101;&#112;&#97;&#120;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;"><img class="spicon" src="/image/email.svg" height="12" width="12"/>Contact</a> </div></li> </ul> </div> <div id="content_container"> <div class="section"> <h2>Keypresses From Joystick</h2> <div class="subsection"> <p>I have been playing quite a few smaller indie games lately and have found that whilst the style of these games often lends itself to using a gamepad, joystick support under Linux on these games is often quite poor. So I wrote a small program to fake keyboard events based on joystick events, thus circumventing any poor joystick support.</p> <p>The program is very simple we read events from the joysticks device file (/dev/input/js0 etc.) and then use the XTest extension to generate keypress events based on these. All configuration of the program is done statically in a header file called "config.h", this defines which joystick device file you will use and which keypresses will be generated in response to which joystick events. You will also need to have the X11 and XTest libraries installed to build the program; on Ubuntu these are the libx11-dev and libxtst-dev packages.</p> <p>Using the program is pretty simple too, edit config.h to your desired settings, build using "make" and then run "joytokey". Then just leave joytokey running whilst you play your game.</p> <h3>Getting the Code</h3> <p>The code can be found on my Bitbucket here: <a href="https://bitbucket.org/charleskeepax/joytokey">joytokey</a></p> <h3>Configuration</h3> <p>The best way to work out what settings you need for your gamepad is to run:</p> <p>jstest --event /dev/input/js0</p> <p>This will print out all the events generated from your joystick (obviously substitue /dev/input/js0 for the joystick you want), simply push the buttons you want to map and observe the values generated. I believe this program is in the joystick package on Ubuntu, if you don't already have it. The output will look something like this:</p> <p><ol> <li>Event: type 1, time 30798287, number 2, value 1</li> <li>Event: type 1, time 30798447, number 2, value 0</li> <li>Event: type 2, time 30806623, number 0, value 32767</li> <li>Event: type 2, time 30806783, number 0, value 0</li> <li>Event: type 2, time 30807503, number 1, value -32767</li> <li>Event: type 2, time 30807663, number 0, value -32767</li> </ol></p> <p>Type 1 events are button presses and type 2 events are direction controls. You should use the number field as the index into the respective configuration array and for direction controls you will need to select a suitable threshold for each direction. Here we show a suitable setup for the direction controls show above:</p> <p><script src="https://gist.github.com/charleskeepax/6262253.js?file=axes.h"></script></p> <p>We map axis 0 to the left and right arrows and axis 1 to the p and l keys. The sym and the str field are interchangable and you should use whatever is simplest to define the key you want to map to. The sym field will be ignored if you specify both.</p> <p>Similarly we setup the buttons mapping buttons 1,2,3,4 to keys q,w and the up and down arrow. Note the key setup is simpler and only requires you to specify the key:</p> <p><script src="https://gist.github.com/charleskeepax/6262253.js?file=buttons.h"></script></p> <p>That should be about it, enjoy.</p> <div class="bp_footer"> <span class="rnote">Posted by <span class="bp_name">Charles Keepax</span> on <span class="bp_date">18/08/2013</span></span> <span class="bp_tags"> <img class="spicon" src="/image/tag.svg" height="16" width="16" alt="tags:"/> <a href="/blog/tags.html#bar_development">development</a> <a href="/blog/tags.html#bar_gaming">gaming</a> </span> </div> </div> </div> </div> <div id="footer_spacer"></div> </div> <div id="footer_container"> <p>Copyright &copy; Charles Keepax 2010-2022. All rights reserved.<a id="privacy_policy" href="/privacy.html">Privacy Policy</a></p> </div> </div> <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <script type="text/javascript">$(document).ready(function(){var a=true;if($("#sidebar_icon").is(":visible")){a=false;$("#sidebar_container > .nav_list").animate({height:"hide"},300)}$(window).resize(function(){if($(window).width()>750||a){$("#sidebar_container > .nav_list").show()}else{$("#sidebar_container > .nav_list").hide()}});$("#sidebar_icon").click(function(){a=!a;$("#sidebar_container > .nav_list").animate({height:"toggle"},300)});$("h2").click(function(){$(this).siblings(".subsection").animate({height:"toggle"},300);if($(this).children("span").length){$(this).children("span").remove()}else{$(this).prepend("<span>+ </span>")}})});</script> </body> </html>