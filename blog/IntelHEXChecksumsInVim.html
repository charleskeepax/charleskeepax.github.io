<!DOCTYPE html> <html> <head> <meta http-equiv="content-type" content="text/html; charset=utf-8"/> <meta http-equiv="content-language" content="en-gb"/> <meta name="language" content="english"/> <meta name="author" content="charles keepax"/> <meta name="robots" content="index, follow"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <link rel="sitemap" href="/sitemap.xml" type="application/xml" title="Sitemap"/> <link rel="shortcut icon" href="/favicon.ico" type="image/vnd.microsoft.icon"/> <link rel="stylesheet" href="/styles/layout.css" type="text/css" media="screen and (min-width: 750px)"/> <link rel="stylesheet" href="/styles/m_layout.css" type="text/css" media="screen and (max-width:750px)"/> <link rel="stylesheet" href="/styles/webblog.css" type="text/css" media="screen and (min-width: 750px)"/> <link rel="stylesheet" href="/styles/m_webblog.css" type="text/css" media="screen and (max-width: 750px)"/> <meta name="description" content="A vim script function that corrects the checksum on a line of an Intel HEX file."/> <meta name="keywords" content="charles keepax, charles, keepax, intel hex,vim,development,embedded"/> <title>Intel HEX Checksums in Vim - Charles Keepax</title> </head> <body> <div> <div id="title_container"> <h1>Charles Keepax's Blog</h1> <a id="feedlink" href="/atom.xml"><img src="/image/rss.svg" height="24" width="24" alt="Atom Feed"/></a> </div> <div id="sidebar_background"></div> <div id="column_container"> <div id="sidebar_container"> <img id="sidebar_icon" src="/image/menu.svg" alt="Toggle Navigation Menu" height="24" width="24"/> <ul class="nav_list"> <li class="nav_item"><div><a href="/blog/blog.html"><img class="spicon" src="/image/calendar.svg" height="12" width="12"/>Blog</a></div></li> <li><ol id="blogposts_sidebar" class="nav_list"> <li class="nav_item"><div> <a href="/blog/WebsiteIcons.html">Website Icons</a> </div></li> <li class="nav_item"><div> <a href="/blog/KeypressesFromJoystick.html">Keypresses From Joystick</a> </div></li> <li class="nav_item"><div> <a href="/blog/IntelHEXChecksumsInVim.html">Intel HEX Checksums in Vim</a> </div></li> <li class="nav_item"><div> <a href="/blog/CPPForEmbedded.html">C++ for Embedded?</a> </div></li> <li class="nav_item"><div> <a href="/blog/UltimateChilliRecipe.html">Ultimate Chilli Recipe?</a> </div></li> <li class="nav_item"><div><a href="/blog/archive.html">Blog Archive</a></div></li> <li class="nav_item"><div><a href="/blog/tags.html">Blog Tags</a></div></li> </ol></li> <li class="nav_item"><div><a href="/cv.html"><img class="spicon" src="/image/doc.svg" height="12" width="12"/>Curriculum Vitae</a></div></li> <li><ol class="nav_list"> <li class="nav_item"><div><a href="/cv.html#cv_profile">Profile</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_employmenthistory">Employment History</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_education">Education</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_publications">Publications</a></div></li> <li class="nav_item"><div><a href="/cv.html#cv_references">References</a></div></li> </ol></li> <li class="nav_item"><div><a href="/links.html"><img class="spicon" src="/image/link.svg" height="12" width="12"/>Links</a></div></li> <li><ol class="nav_list"> <li class="nav_item"><div><a href="https://bitbucket.org/charleskeepax">Bitbucket</a></div></li> <li class="nav_item"><div><a href="http://github.com/charleskeepax">Github</a></div></li> <li class="nav_item"><div><a href="http://uk.linkedin.com/pub/charles-keepax/24/b79/59a">LinkedIn</a></div></li> <li class="nav_item"><div><a href="http://stackoverflow.com/users/735744/charles-keepax">Stackoverflow</a></div></li> </ol></li> <li class="nav_item"><div> <a href="mailto:&#99;&#107;&#101;&#101;&#112;&#97;&#120;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;"><img class="spicon" src="/image/email.svg" height="12" width="12"/>Contact</a> </div></li> </ul> </div> <div id="content_container"> <div class="section"> <h2>Intel HEX Checksums in Vim</h2> <div class="subsection"> <p>If you do any work in the embedded world you have no doubt come across <a href="http://en.wikipedia.org/wiki/Intel_HEX">Intel HEX</a> files. Intel HEX files provide a text representation of binary data and are often used for programming of Flash and EEPROM parts. Each line of the file contains a checksum at the end, when manually editing the file updating the checksums is very annoying. To fix this I have written a small bit of vim script to automatically correct said checksum.</p> <p><script src="https://gist.github.com/1665854.js?file=ihex.vim"></script></p> <p>The code embedded here will probably not be kept up to date with bug fixes etc. in the future so you are better off getting the latest version from the <a href="https://bitbucket.org/charleskeepax/vimintelhex">Mercurial repository</a>.</p> <p>The simplest way to install the code is to put a copy of the function in your vimrc file. Alternatively, you could load it from another file by putting &quot;source path/filename&quot; into your vimrc file.</p> <p>The function operates on the current line of text, and is invoked by typing &quot;:call IHexChecksum()&quot; in normal mode. This could be simplified by addeding a key mapping to your vimrc file, such as &quot;map <C-h> :call IHexChecksum()<CR>&quot;, which will invoke the function whenever Ctrl-h is pressed. Once invoked the function will check the current line is valid Intel HEX, calculate the checksum, and then replace the last two characters of the line with the corrected value. It is important to note that the checksum is updated rather than two characters being added, such that if you are writing new lines you will want to add in a bogus checksum first. I find myself usually editing small changes into existing lines of a file rather add new lines so updating seemed the logical choice.</p> <p>The code itself is pretty simple and should be rather self explanatory. First the input line is matched to a regular expression, this checks the line is valid Intel HEX. The regular expression checks for the existance of a colon at the start of the line, that the rest of the line contains an even number of characters all of which are valid hexadecimal characters, and that it is at least 5 bytes long. The checksum is then calculated by reading the input one byte at a time, care is taken to account for overflow whilst twos complimenting the checksum. Finally the line is written back with the last two digits corrected.</p> <p>Hopefully, someone out there finds this little script as useful as I do. Please feel free to use/edit/pretend it's yours/do whatever with the code, although I would appreciate hearing about any bugs/improvements. I am rather new to using Vim script and suspect the script could be improved somewhat.</p> <div class="bp_footer"> <span class="rnote">Posted by <span class="bp_name">Charles Keepax</span> on <span class="bp_date">24/01/2012</span></span> <span class="bp_tags"> <img class="spicon" src="/image/tag.svg" height="16" width="16" alt="tags:"/> <a href="/blog/tags.html#bar_intelhex">intel hex</a> <a href="/blog/tags.html#bar_vim">vim</a> <a href="/blog/tags.html#bar_development">development</a> <a href="/blog/tags.html#bar_embedded">embedded</a> </span> </div> </div> </div> </div> <div id="footer_spacer"></div> </div> <div id="footer_container"> <p>Copyright &copy; Charles Keepax 2010-2022. All rights reserved. </div> </div> <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <script type="text/javascript">$(document).ready(function(){var a=true;if($("#sidebar_icon").is(":visible")){a=false;$("#sidebar_container > .nav_list").animate({height:"hide"},300)}$(window).resize(function(){if($(window).width()>750||a){$("#sidebar_container > .nav_list").show()}else{$("#sidebar_container > .nav_list").hide()}});$("#sidebar_icon").click(function(){a=!a;$("#sidebar_container > .nav_list").animate({height:"toggle"},300)});$("h2").click(function(){$(this).siblings(".subsection").animate({height:"toggle"},300);if($(this).children("span").length){$(this).children("span").remove()}else{$(this).prepend("<span>+ </span>")}})});</script> </body> </html>